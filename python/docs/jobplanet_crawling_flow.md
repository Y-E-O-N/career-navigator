# 잡플래닛 크롤링 플로우 문서

## 개요
이 문서는 `company_analyzer.py`의 잡플래닛 크롤링 순서, 대기 시간, 주요 동작을 설명합니다.

---

## 1. 브라우저 초기화 및 로그인

### 1.1 브라우저 시작
```
[브라우저 시작] nodriver (headless=False)
    ↓
[대기] 암묵적 대기
    ↓
[로그인 페이지 이동] https://www.jobplanet.co.kr/users/sign_in
    ↓
[대기] 3초
```

### 1.2 로그인 과정
```
[이메일 입력] input[type="email"]
    ↓
[대기] 0.5초
    ↓
[비밀번호 입력] input[type="password"]
    ↓
[대기] 0.5초
    ↓
[로그인 버튼 클릭] "이메일로 로그인" 버튼
    ↓
[대기] 5초 (로그인 처리)
    ↓
[로그인 확인] URL에 'sign_in' 포함 여부
```

---

## 2. 회사 검색 및 매칭

### 2.1 검색 과정
```
[검색 URL 이동] https://www.jobplanet.co.kr/search/companies?query={회사명}
    ↓
[대기] 3초 (페이지 로드)
    ↓
[스크롤] 600px (검색 결과 로드)
    ↓
[대기] 2초
    ↓
[회사 매칭] 점수 기반 매칭 (정확일치 100점, 시작일치 80점, 포함 50점 + 길이보너스)
```

### 2.2 회사 매칭 점수 계산
| 조건 | 기본 점수 | 길이 보너스 |
|------|-----------|-------------|
| 정확히 일치 | 100점 | max(0, 20-이름길이) |
| 검색어로 시작 | 80점 | max(0, 20-이름길이) |
| 검색어 포함 | 50점 | max(0, 20-이름길이) |
| 역방향 포함 | 30점 | max(0, 20-이름길이) |

---

## 3. 탭별 크롤링 순서

### 크롤링 순서
```
1. 리뷰 (/reviews)
    ↓
2. 연봉 (/salaries)
    ↓
3. 면접 (/interviews)
    ↓
4. 복지 (/benefits)
    ↓
5. 채용 (/job_postings)
    ↓
6. 기업정보 (/landing)
    ↓
7. 프리미엄리뷰 (/premium_reviews)
```

---

## 4. 리뷰 페이지 (/reviews)

### 4.1 기본 흐름
```
[페이지 이동] /companies/{id}/reviews
    ↓
[대기] 3초
    ↓
[팝업 닫기] "괜찮아요" 버튼 또는 jp-x 아이콘
    ↓
[대기] 1초 (팝업 닫힘 확인)
    ↓
[통계 데이터 수집] .rate_pie_set 에서 추출
    ├─ 리뷰 수
    ├─ 평점
    ├─ 기업 추천율 (%)
    ├─ CEO 지지율 (%)
    └─ 성장 가능성 (%)
```

### 4.2 연도별 트렌드 수집
```
[버튼 클릭] "연도별 트렌드 보기"
    ↓
[대기] 2초
    ↓
[연도 목록 수집] 전체, 2026, 2025, 2024, ... (최대 10개)
    ↓
for year in [전체, 2026, 2025, ...]:
    [연도 링크 클릭] a[href*="reviews"]
        ↓
    [대기] 1.5초 (데이터 로드)
        ↓
    [데이터 수집] 해당 연도 만족도 점수
        ├─ 총 만족도
        ├─ 승진 기회
        ├─ 복지 및 급여
        ├─ 워라밸
        ├─ 사내문화
        └─ 경영진
```

**수집 결과**: `yearly_trends` 딕셔너리에 연도별 만족도 점수 저장
```json
{
  "yearly_trends": {
    "전체": {"총 만족도": 3.8, "승진 기회": 3.2, ...},
    "2026": {"총 만족도": 4.0, "승진 기회": 3.5, ...},
    "2025": {"총 만족도": 3.7, "승진 기회": 3.1, ...}
  }
}
```

### 4.3 키워드 수집
```
[스크롤] 1000px
    ↓
[대기] 2초
    ↓
[장점 키워드 수집]
    ├─ 현재 페이지 키워드 수집
    ├─ [다음 버튼 클릭] jp-chevron-right
    ├─ [대기] 0.5초
    └─ 반복 (최대 10페이지)
    ↓
[단점 탭 클릭] label[for="reviewKeywordOption2"]
    ↓
[대기] 1초
    ↓
[단점 키워드 수집] (장점과 동일한 방식)
```

### 4.4 직군별 만족도
```
[데이터 수집] highcharts 그래프에서 직군/점수 매칭
```

### 4.5 맞춤 기업 찾기 (차트 스크린샷)
```
[탭 클릭] "맞춤 기업 찾기"
    ↓
[대기] 2초
    ↓
for x in [총만족도, 승진기회, 복지급여, 워라밸, 사내문화, 경영진]:
  for y in [총만족도, 승진기회, 복지급여, 워라밸, 사내문화, 경영진]:
    for size in [총만족도, 승진기회, 복지급여, 워라밸, 사내문화, 경영진]:
      [select 값 변경] #xaxis-select, #yaxis-select, #size-select
          ↓
      [대기] 0.5초 (차트 업데이트)
          ↓
      [스크린샷 저장] data/charts/{회사명}/chart_x{x}_y{y}_s{size}.png
```

**총 스크린샷 수**: 6 × 6 × 6 = **216개**

**저장 위치**: `python/data/charts/{회사명}/`

### 4.6 개별 리뷰 수집 (페이지네이션)
```
[점진적 스크롤] 500~700px씩 하단까지
    ↓
[리뷰 추출] section[id^="review_"]
    기본 정보:
    - 직군 (.text-body2.text-gray-400 첫 번째)
    - 현/전직원 (text-gray-400 중 "직원" 포함)
    - 지역 (text-gray-400 중 지역명)
    - 작성일 (text-gray-400 중 날짜 패턴)

    평점 정보:
    - 총 평점 (.text-h5.text-gray-800)
    - 항목별 평점 (#ReviewCardSide .space-y-[16px] > li):
        - 승진 기회
        - 복지/급여
        - 워라밸
        - 사내문화
        - 경영진

    리뷰 내용:
    - 제목 (h2.text-h7)
    - 장점 (bg-blue-50 라벨 다음 텍스트)
    - 단점 (bg-red-50 라벨 다음 텍스트)
    - 경영진에 바라는 점 (bg-gray-50 라벨 다음 텍스트)

    태그 정보 (.ReviewCardTag):
    - 1년 후 예상: "1년 후에도 비슷할 것 같아요" 등
    - 기업 추천 여부: "기업을 추천해요" / "기업을 비추천해요"
    ↓
[다음 페이지 이동] ?page={n+1}
    ↓
[대기] 3초
    ↓
[팝업 닫기]
    ↓
[점진적 스크롤] 500~700px씩 하단까지
    ↓
반복 (최대 50페이지 또는 500개 리뷰)
```

### 4.8 개별 리뷰 데이터 구조
```json
{
    "id": "5510979",
    "job": "미디어/홍보",
    "employment_status": "전직원",
    "location": "경기",
    "write_date": "2026. 01 작성",
    "total_rating": 5.0,
    "category_scores": {
        "승진 기회": 4,
        "복지/급여": 5,
        "워라밸": 5,
        "사내문화": 5,
        "경영진": 4
    },
    "title": "매우 유연, 그만큼 책임감도 필요한 기업",
    "pros": "유연함 : 부바부는 있겠지만...",
    "cons": "장점의 유연함을 악용하는 경우가...",
    "advice": "단기적인 이익이 다가 아닌...",
    "future_outlook": "1년 후에도 비슷할 것 같아요",
    "recommendation": "기업을 추천해요"
}
```

### 4.7 점진적 스크롤 상세
```
while (하단 미도달):
    [현재 위치 확인] scrollY, innerHeight, scrollHeight
    [스크롤] 500~700px (랜덤)
    [대기] 0.3~0.6초 (랜덤)
[최종 대기] 1초 (콘텐츠 로드)
```

---

## 5. 연봉 페이지 (/salaries)

### 5.1 기본 흐름
```
[페이지 이동] /companies/{id}/salaries
    ↓
[대기] 3초
    ↓
[팝업 닫기]
    ↓
[대기] 1초
```

### 5.2 전체 직종 평균 연봉
```
[데이터 수집] em.text-h2 (평균 연봉 금액)
```

### 5.3 업계 비교 정보
```
[데이터 수집] .bg-green-50 .border-green-500
    - 업계 평균 연봉: "업계 평균 연봉은 X,XXX만원"
    - 업계 내 순위: "상위X%에 해당하는 연봉을 제공"
```

### 5.4 년차별 연봉 수집
```
[드롭다운 열기] 년차 선택 버튼 클릭
    ↓
[대기] 0.5초
    ↓
[년차 목록 수집] 1년차, 2년차, ... 15년차
    ↓
[드롭다운 닫기] ESC 키
    ↓
[대기] 0.3초
    ↓
for each 년차 (최대 15년차):
    [드롭다운 열기]
        ↓
    [대기] 0.3초
        ↓
    [년차 선택] 클릭
        ↓
    [대기] 0.5초
        ↓
    [데이터 수집] 평균 연봉 금액, 예상 연봉 인상률
```

---

## 6. 면접 페이지 (/interviews)

### 6.1 기본 흐름
```
[페이지 이동] /companies/{id}/interviews
    ↓
[대기] 3초
    ↓
[팝업 닫기]
    ↓
[대기] 1초
```

### 6.2 통계 요약 수집
```
[데이터 수집]
    - 면접 난이도: .vib_num (점수), .vib_txt (레벨)
    - 면접 경로: table[summary="면접경로"]
    - 면접 경험: table[summary="면접경험"]
    - 면접 결과: table[summary="면접결과"]
```

### 6.3 개별 면접 후기 수집 (페이지네이션)
```
[점진적 스크롤] 500~700px씩 하단까지
    ↓
[면접 후기 추출] section[data-content_type="interview"]
    기본 정보:
    - 직군/직급: .txt1
    - 날짜: .txt2
    - 면접난이도: .blo_txt2, .us_txt_mr
    - 면접경로: .ctbody_lft .txt2

    면접 내용:
    - 제목/요약: .us_label h2
    - 면접질문: dt.df_tit:contains("면접질문") 다음 dd
    - 면접답변/느낌: .answer, [id*="interview_answer"]
    - 발표시기: dt.df_tit:contains("발표시기") 다음 dd (예: "30일 후", "7일 후")

    결과 정보:
    - 면접결과: .rt_pass (합격), .rt_fail (불합격), .rt_waiting (대기)
    - 면접경험: .ex_psv (긍정적), .ex_ngt (부정적), .ex_nor (보통)
    ↓
[다음 페이지 이동] ?page={n+1}
    ↓
[대기] 3초
    ↓
[팝업 닫기]
    ↓
[점진적 스크롤]
    ↓
반복 (최대 50페이지 또는 300개 면접 후기)
```

### 6.4 개별 면접 후기 데이터 구조
```json
{
    "id": "2173254",
    "job": "기획/경영",
    "position": "대리",
    "date": "2026. 01. 24",
    "difficulty": "보통",
    "route": "직원추천",
    "title": "실무 위주로 질의응답이 진행됐고...",
    "question": "그냥 너무 평범했고 어려울 게 없어서...",
    "answer": "그냥 찐 실무자가 일하다가 나온 느낌",
    "announcement_timing": "30일 후",
    "result": "합격",
    "experience": "긍정적"
}
```

---

## 7. 복지 페이지 (/benefits)

### 7.1 기본 흐름
```
[페이지 이동] /companies/{id}/benefits
    ↓
[대기] 3초
    ↓
[팝업 닫기]
    ↓
[대기] 1초
```

### 7.2 복지 요약 수집
```
[데이터 수집] .welfare-summary
    - 전체 복지 평점: .welfare-average .welfare-star__point
    - 총 건수: .welfare-summary__ref (예: "총 270건")
    - 복지 개수: .welfare-overview__num (예: 69)
```

### 7.3 평점 분포도 수집
```
[데이터 수집] .welfare-overview__bar
    - 1점~5점 각 비율: .welfare-overview__val .job_tooltip_inner
```

### 7.4 복지 순위 정보 수집
```
[데이터 수집] .welfare-summary__ranking
    1) 만족도가 가장 높은 복지 TOP 3 (첫 번째 .welfare-summary__ranking)
        - 순위: .welfare-rank__num
        - 복지명: .welfare-rank__tit
        - 응답수: .welfare-rank__cnt
        - 평점: .welfare-section__score p

    2) 가장 많이 사용한 복지 TOP 3 (두 번째 .welfare-summary__ranking)
        - 순위: .welfare-rank__num
        - 복지명: .welfare-rank__tit
        - 응답수: .welfare-rank__cnt
        - 비율: .welfare-rank__percent
```

### 7.5 복지 목록 카테고리별 수집
```
[스크롤] 600px
    ↓
[대기] 1초
    ↓
[데이터 수집] .welfare-bullet
    - 카테고리명: .welfare-bullet__tit
    - 복지 항목: .welfare-bullet__item .item-name
    - 직원 등록 여부: .item-author (텍스트에 "직원 등록" 포함)

    카테고리 목록:
    - 의료/건강
    - 지원 제도
    - 교통/출퇴근
    - 급여/보상
    - 연차/휴가
    - 근무환경
    - 교육/자기계발
```

### 7.6 복지 후기 수집 (페이지네이션)
```
[점진적 스크롤] 하단까지
    ↓
[복지 후기 추출] .welfare-content__box
    수집 항목:
    - 카테고리: .welfare-content__star .category
    - 카테고리별 평점: .welfare-content__star .welfare-star__point
    - 작성자 정보 (.welfare-profile__txt):
        - 직군 (개발, 영업 등)
        - 현직원/전직원
        - 지역
        - 정규직/계약직
    - 후기 내용: .welfare-content__comment
    - 개별 복지 항목 평점 (.welfare-content__item):
        - 복지명: span:first-child
        - 평점: .welfare-section__score p
    - 제외: .jply_section (직장 생활 치트키)
    ↓
[다음 페이지 버튼 클릭] .jply_pagination_ty1 button
    ↓
[대기] 3초
    ↓
[팝업 닫기]
    ↓
[점진적 스크롤]
    ↓
반복 (최대 20페이지)
```

### 7.7 수집 데이터 구조
```json
{
    "overall_rating": 4.3,
    "total_count": 270,
    "welfare_count": 69,
    "rating_distribution": {"1점": "3%", "2점": "5%", ...},
    "top_satisfaction": [
        {"rank": "1", "name": "의료비 지원", "count": "(3명)", "score": 5.0}
    ],
    "most_used": [
        {"rank": "1", "name": "구내 식당", "count": "(24명)", "percent": "15%"}
    ],
    "welfare_by_category": {
        "의료/건강": [{"name": "건강검진 지원", "employee_registered": false}],
        "지원 제도": [...],
        ...
    },
    "welfare_reviews": [
        {
            "category": "의료/건강",
            "category_rating": 3.7,
            "profile": {
                "job": "개발",
                "employment_status": "현직원",
                "location": "경기",
                "employment_type": "정규직"
            },
            "content": "사내 병원이 있어서...",
            "item_scores": [
                {"name": "건강검진 지원", "score": 4},
                {"name": "상해/실손 보험 지원", "score": 4}
            ]
        }
    ]
}
```

---

## 8. 채용 페이지 (/job_postings)

### 8.1 기본 흐름
```
[페이지 이동] /companies/{id}/job_postings
    ↓
[대기] 3초
    ↓
[팝업 닫기]
    ↓
[대기] 1초
    ↓
[점진적 스크롤] 하단까지
```

### 8.2 채용 정보 수집
```
[데이터 수집]
    - 채용 공고 수
    - 각 공고: 직무명, 지역, 경력, 마감일
```

---

## 9. 기업정보 페이지 (/landing)

### 9.1 기본 흐름
```
[페이지 이동] /companies/{id}/landing
    ↓
[대기] 3초
    ↓
[팝업 닫기]
    ↓
[대기] 1초
```

### 9.2 기업 정보 수집
```
[데이터 수집] #profile 섹션
    ├─ 산업
    ├─ 기업형태
    ├─ 사원수
    ├─ 설립
    ├─ 대표자
    ├─ 매출액
    ├─ 주소
    ├─ 웹사이트/홈페이지
    └─ 연혁
```

**수집 결과 JSON 구조**:
```json
{
  "industry": "포털/인터넷/콘텐츠",
  "company_type": "중견기업",
  "employee_count": "3,052명",
  "founded_date": "1995.02.16",
  "ceo": "남궁훈, 홍은택",
  "revenue": "-",
  "address": "제주 제주시 첨단로 242",
  "website": "www.kakaocorp.com",
  "history": "-"
}
```

---

## 10. 프리미엄 리뷰 페이지 (/premium_reviews)

### 10.1 기본 흐름
```
[페이지 이동] /companies/{id}/premium_reviews
    ↓
[대기] 3초
    ↓
[팝업 닫기]
    ↓
[대기] 3초
```

### 10.2 카테고리별 Q&A 수집
```
for each 카테고리 in [직무와 커리어, 업무 방식, 일과 삶의 균형, 복지 및 급여, 기업 만족도]:
    [카테고리 버튼 클릭]
        ↓
    [대기] 1초
        ↓
    ["답변 더 보기" 반복 클릭] (최대 30회)
        ├─ [클릭]
        ├─ [대기] 0.3초
        └─ 버튼 없으면 종료
        ↓
    [Q&A 수집]
        - 카테고리, 질문, 답변들, 기타 의견
```

---

## 11. 대기 시간 요약

### 11.1 페이지 이동 관련
| 동작 | 대기 시간 |
|------|-----------|
| 페이지 이동 후 | 3초 |
| 팝업 닫기 후 | 1초 |
| 로그인 처리 | 5초 |

### 11.2 스크롤 관련
| 동작 | 대기 시간 |
|------|-----------|
| 일반 스크롤 후 | 1~2초 |
| 점진적 스크롤 (각 단계) | 0.3~0.6초 (랜덤) |
| 점진적 스크롤 완료 후 | 1초 |

### 11.3 버튼 클릭 관련
| 동작 | 대기 시간 |
|------|-----------|
| 드롭다운 열기 후 | 0.3~0.5초 |
| 옵션 선택 후 | 0.5초 |
| 키워드 페이지 전환 | 0.5초 |
| 답변 더 보기 클릭 | 0.3초 |

### 11.4 입력 관련
| 동작 | 대기 시간 |
|------|-----------|
| 이메일/비밀번호 입력 후 | 0.5초 |

---

## 12. 점진적 스크롤 상세

### 목적
- 봇 탐지 회피
- 동적 콘텐츠 로드 보장

### 파라미터
| 파라미터 | 기본값 | 설명 |
|----------|--------|------|
| scroll_min | 500px | 최소 스크롤 거리 |
| scroll_max | 700px | 최대 스크롤 거리 |
| delay_min | 0.3초 | 최소 대기 시간 |
| delay_max | 0.6초 | 최대 대기 시간 |

### 종료 조건
```
scrollY + innerHeight >= scrollHeight - 10
```

---

## 13. 팝업 처리

### 적용 시점 (모든 페이지에서 항상 실행)
```
[페이지 이동]
    ↓
[대기] 3초
    ↓
[팝업 닫기] ← 항상 실행
    ↓
[스크롤/데이터 수집]
```

### 적용 위치
| 위치 | 적용 여부 |
|------|-----------|
| 메인 탭 이동 후 | ✓ |
| 리뷰 페이지네이션 후 | ✓ |
| 면접 페이지네이션 후 | ✓ |
| 복지 페이지네이션 후 | ✓ |
| 프리미엄 리뷰 카테고리 전환 후 | ✓ |

### 처리 순서
1. "괜찮아요" 버튼 (`#btn-no-thanks`, `button[onclick*="noThanks"]`)
2. jp-x 아이콘 (`i.jp-x`)
3. 모달 닫기 버튼 (`.modal [class*="close"]`)
4. ESC 키 전송

### 팝업 유형
- 팔로우 요청 팝업: "괜찮아요" 버튼 클릭
- 일반 모달: X 버튼 또는 ESC

### 코드
```python
async def _close_popup(self, page):
    # 1. "괜찮아요" 버튼
    # 2. jp-x 아이콘
    # 3. 모달 닫기 버튼
    # 4. ESC 키
```

---

## 14. 오류 처리

### 브라우저 오류 시
```
[오류 발생]
    ↓
[브라우저 종료] self._browser.stop()
    ↓
[인스턴스 초기화] self._browser = None
    ↓
[다음 회사에서 브라우저 재시작]
```

### 페이지 오류 시
```
[오류 발생]
    ↓
[로그 기록] debug level
    ↓
[다음 탭으로 진행]
```

---

## 15. 수집 제한

| 항목 | 최대 값 |
|------|---------|
| 리뷰 페이지 | 50페이지 |
| 리뷰 개수 | 500개 |
| 면접 후기 페이지 | 50페이지 |
| 면접 후기 개수 | 300개 |
| 복지 후기 페이지 | 20페이지 |
| 키워드 페이지 | 10페이지 |
| 년차별 연봉 | 15년차 |
| 답변 더 보기 클릭 | 30회 |
| **맞춤 기업 찾기 스크린샷** | **216개 (6×6×6)** |

---

## 16. 예상 소요 시간

### 회사당 예상 크롤링 시간
| 탭 | 예상 시간 |
|----|-----------|
| 로그인 (최초 1회) | ~15초 |
| 검색 및 매칭 | ~10초 |
| 리뷰 (50페이지) | ~5-10분 |
| **맞춤 기업 찾기 (216 스크린샷)** | **~2-3분** |
| 연봉 (15년차) | ~30초 |
| 면접 (50페이지) | ~5-10분 |
| 복지 (20페이지) | ~2-3분 |
| 채용 | ~15초 |
| 기업정보 | ~10초 |
| 프리미엄 리뷰 (5카테고리) | ~2-3분 |

**총 예상 시간: 회사당 20~35분** (리뷰/면접 페이지 수에 따라 변동)

---

## 17. 파일 위치

- **메인 코드**: `python/analyzers/company_analyzer.py`
- **설정 파일**: `python/.env` (로그인 정보)
- **크롤링 가이드**:
  - `python/jobplanet_crawling_guide.md`
  - `python/jobplanet_crawling_guide_02.md`
- **수집 데이터**:
  - `python/data/raw_html/` - 페이지별 HTML/텍스트
  - `python/data/charts/{회사명}/` - 맞춤 기업 찾기 스크린샷 (216개)
